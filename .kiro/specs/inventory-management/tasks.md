# 在庫管理システム実装計画

## 実装タスク

- [x] 1. プロジェクト基盤とデータベース設定



  - Node.js + Express.js プロジェクトの初期化
  - PostgreSQL データベースの設定
  - 基本的なプロジェクト構造の作成
  - 環境変数とコンフィグファイルの設定
  - _要件: 全要件の基盤_

- [x] 2. データベーススキーマとモデル実装


  - 在庫、予約、サイト担当者、通知ログテーブルの作成
  - 個別機器管理テーブル（equipment_items、equipment_usage_history）の作成
  - データベースマイグレーションスクリプトの作成
  - ORM/データアクセス層の実装
  - _要件: 2.1, 3.1, 12.1, 19.1, 19.2_

- [ ] 2.1 データモデルのプロパティテスト作成
  - **プロパティ3: 予約・キャンセル往復の一貫性**
  - **検証対象: 要件 3.1, 3.2**

- [ ] 3. 認証システム実装
  - Midway認証統合（理想実装）
  - Alias検証システム（代替実装）
  - セッション管理とミドルウェア
  - 認証エラーハンドリング
  - _要件: 10.1, 10.2, 11.1_

- [ ] 3.1 認証システムのプロパティテスト
  - **プロパティ5: 認証情報の自動設定**
  - **検証対象: 要件 10.2**

- [ ] 4. 在庫管理エンジン実装
  - 在庫確認と可用性計算ロジック
  - 予約時の在庫減算処理
  - キャンセル時の在庫復旧処理
  - 代替案提案アルゴリズム
  - _要件: 1.1, 1.2, 3.1, 3.2_

- [ ] 4.1 在庫管理のプロパティテスト
  - **プロパティ1: 在庫確認の一貫性**
  - **検証対象: 要件 1.1**

- [ ] 4.2 代替案提案のプロパティテスト
  - **プロパティ2: 代替案提案の完全性**
  - **検証対象: 要件 1.2**

- [x] 5. 通知システム実装


  - メール送信サービス（SMTP/SendGrid）
  - Slack API統合
  - 通知テンプレート管理
  - 送信失敗時のリトライ機構
  - _要件: 6.1, 7.1, 14.1_

- [ ] 5.2 機器コード通知機能実装
  - 予約確認メールに機器コード情報を追加
  - 設置完了通知に機器コード情報を追加
  - 返却リマインダーに機器コード情報を追加
  - _要件: 20.1, 20.3, 20.4_

- [ ] 5.1 通知システムのプロパティテスト
  - **プロパティ4: 通知送信の確実性**
  - **検証対象: 要件 6.1**

- [ ] 6. 予約管理システム実装
  - 予約作成・更新・キャンセル機能
  - 予約ステータス管理
  - 予約ID生成とユニーク性保証
  - 予約データの整合性チェック
  - _要件: 1.1, 3.1, 3.2, 6.1_

- [ ] 6.1 個別機器管理システム実装
  - 機器コード生成システム（AL1、NAL1、Monitor1形式）
  - 機器登録・更新・削除機能
  - 機器ステータス管理（利用可能、使用中、メンテナンス中）
  - 予約時の自動機器割り当て機能
  - _要件: 19.1, 19.2, 19.3, 19.10_

- [ ] 6.2 機器使用履歴管理実装
  - 使用履歴の記録・更新機能
  - 機器別使用履歴表示
  - 使用者別履歴表示
  - 使用統計レポート機能
  - _要件: 19.5, 19.8_

- [ ] 6.3 個別機器管理のプロパティテスト
  - **プロパティ9: 機器割り当ての一意性**
  - **検証対象: 要件 19.3**

- [ ] 7. フロントエンド統合
  - 既存index.htmlの拡張
  - 在庫状況表示の統合
  - 認証フローの実装
  - エラーメッセージとユーザーフィードバック
  - _要件: 1.1, 10.1, 11.1_

- [ ] 7.1 個別機器表示機能実装
  - 予約詳細画面での機器コード表示
  - 機器受け取り時の照合機能
  - 返却時の機器コード確認画面
  - 機器コード検索機能
  - _要件: 20.1, 20.2, 20.4, 20.6_

- [x] 8. 管理ダッシュボード実装



  - 在庫管理画面
  - 予約状況一覧
  - サイト担当者管理
  - 統計とレポート機能
  - _要件: 2.1, 4.1, 12.1, 15.1_

- [ ] 8.1 個別機器管理画面実装
  - 全機器一覧表示（機器コード、ステータス、使用者）
  - 使用中機器一覧表示
  - 機器詳細情報表示
  - 機器メンテナンス状態管理
  - 機器使用履歴表示
  - _要件: 19.1, 19.5, 19.6, 19.7, 19.8_

- [ ] 9. 設置管理機能実装
  - 設置リマインダー送信
  - Slack「設置完了」ボタン機能
  - 設置完了通知システム
  - 設置ステータス管理
  - _要件: 8.1, 13.1, 14.1, 15.1_

- [ ] 9.1 設置完了のプロパティテスト
  - **プロパティ6: 設置完了処理の原子性**
  - **検証対象: 要件 13.2**

- [x] 10. 返却管理機能実装


  - 返却リマインダーシステム
  - Slack「返却済み」ボタン機能
  - 返却時在庫復旧処理
  - 返却遅延管理と催促通知
  - _要件: 16.1, 17.1, 18.1_

- [ ] 10.1 返却管理のプロパティテスト
  - **プロパティ7: 返却時在庫復旧の即時性**
  - **検証対象: 要件 16.2**

- [ ] 10.2 返却催促のプロパティテスト
  - **プロパティ8: 返却催促の継続性**
  - **検証対象: 要件 17.2**

- [ ] 11. API エンドポイント実装
  - 予約CRUD API
  - 在庫管理API
  - 通知管理API
  - 管理者機能API
  - 個別機器管理API（機器CRUD、使用履歴、ステータス管理）
  - _要件: 全要件のAPI層_

- [ ] 11.1 API統合テスト
  - エンドツーエンドのAPI動作確認
  - エラーレスポンスの検証
  - レート制限とセキュリティテスト
  - _要件: 全要件の統合確認_

- [ ] 12. セキュリティとエラーハンドリング
  - 入力検証とサニタイゼーション
  - SQLインジェクション対策
  - レート制限実装
  - ログ記録とモニタリング
  - _要件: 11.1, 5.1_

- [ ] 13. ユニットテスト実装
  - 各コンポーネントのユニットテスト
  - エッジケースとエラー条件のテスト
  - モック・スタブの実装
  - テストカバレッジの確保
  - _要件: 全要件のユニットテスト_

- [ ] 14. チェックポイント - 全テスト実行
  - 全てのテストが通ることを確認し、ユーザーに質問があれば対応する

- [ ] 15. デプロイメントと運用設定
  - 本番環境設定
  - データベースマイグレーション
  - 環境変数とシークレット管理
  - ヘルスチェックとモニタリング
  - _要件: システム全体の運用_

- [ ] 15.1 本番環境テスト
  - 本番データでの動作確認
  - パフォーマンステスト
  - 障害復旧テスト
  - _要件: システム全体の信頼性_

- [ ] 16. 最終チェックポイント - 全システム検証
  - 全てのテストが通ることを確認し、ユーザーに質問があれば対応する